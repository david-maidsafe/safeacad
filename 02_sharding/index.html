



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>Sharding / Disjoint Sections - SAFE Fleming Bible</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#ff7043">
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-orange" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#sharding-disjoint-sections" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="SAFE Fleming Bible" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              SAFE Fleming Bible
            </span>
            <span class="md-header-nav__topic">
              Sharding / Disjoint Sections
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="SAFE Fleming Bible" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    SAFE Fleming Bible
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="SAFE Fleming Bible" class="md-nav__link">
      SAFE Fleming Bible
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../01_glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Sharding / Disjoint Sections
      </label>
    
    <a href="./" title="Sharding / Disjoint Sections" class="md-nav__link md-nav__link--active">
      Sharding / Disjoint Sections
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link">
    Summary
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#splits" title="Splits" class="md-nav__link">
    Splits
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merges" title="Merges" class="md-nav__link">
    Merges
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#status" title="Status" class="md-nav__link">
    Status
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" title="How it works" class="md-nav__link">
    How it works
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sections" title="Sections" class="md-nav__link">
    Sections
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neighbours" title="Neighbours" class="md-nav__link">
    Neighbours
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siblings" title="Siblings" class="md-nav__link">
    Siblings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splitting" title="Splitting" class="md-nav__link">
    Splitting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#split-mechanism" title="Split mechanism" class="md-nav__link">
    Split mechanism
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merging" title="Merging" class="md-nav__link">
    Merging
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features" title="Features" class="md-nav__link">
    Features
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootstrapping" title="Bootstrapping" class="md-nav__link">
    Bootstrapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#balanced-relocation" title="Balanced Relocation" class="md-nav__link">
    Balanced Relocation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splits_1" title="Splits" class="md-nav__link">
    Splits
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merge" title="Merge" class="md-nav__link">
    Merge
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits" title="Benefits" class="md-nav__link">
    Benefits
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../03_authorities/" title="Authorities" class="md-nav__link">
      Authorities
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../04_sections/" title="Groups & Sections" class="md-nav__link">
      Groups & Sections
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../05_messaging/" title="Message Relay & SMR" class="md-nav__link">
      Message Relay & SMR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../06_chain/" title="Chain" class="md-nav__link">
      Chain
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../07_parsec/" title="PARSEC" class="md-nav__link">
      PARSEC
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../08_ageing/" title="Node Ageing" class="md-nav__link">
      Node Ageing
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link">
    Summary
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#splits" title="Splits" class="md-nav__link">
    Splits
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merges" title="Merges" class="md-nav__link">
    Merges
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#status" title="Status" class="md-nav__link">
    Status
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" title="How it works" class="md-nav__link">
    How it works
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sections" title="Sections" class="md-nav__link">
    Sections
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neighbours" title="Neighbours" class="md-nav__link">
    Neighbours
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siblings" title="Siblings" class="md-nav__link">
    Siblings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splitting" title="Splitting" class="md-nav__link">
    Splitting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#split-mechanism" title="Split mechanism" class="md-nav__link">
    Split mechanism
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merging" title="Merging" class="md-nav__link">
    Merging
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features" title="Features" class="md-nav__link">
    Features
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootstrapping" title="Bootstrapping" class="md-nav__link">
    Bootstrapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#balanced-relocation" title="Balanced Relocation" class="md-nav__link">
    Balanced Relocation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splits_1" title="Splits" class="md-nav__link">
    Splits
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merge" title="Merge" class="md-nav__link">
    Merge
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benefits" title="Benefits" class="md-nav__link">
    Benefits
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="sharding-disjoint-sections">Sharding / Disjoint Sections</h1>
<h2 id="summary">Summary</h2>
<p>Strategy used to scale a Network by distributing the load between "shards" where each "shard" is only responsible for part of the Network's functioning.
In the SAFE Network, Disjoint Sections act as shards which is process by which sections change size, the location of responsibility and often their Neighbours due to splits and merges.</p>
<h3 id="splits">Splits</h3>
<p>Triggered by a new node joining
Split is the process by which a section makes a binary split into two smaller sections.
Splits only occur once certain factors have been met:
There must be a minimum group size for each child
Plus a buffer
Splits are a valid loss of information, neighbours and responsibility for a node</p>
<h3 id="merges">Merges</h3>
<p>If the nodes in a Section fall below the ‘MinimumGroupSize’, the nodes of one Section will merge with their sibling.
Merges lead to an increase in area of responsibility.</p>
<h2 id="status">Status</h2>
<p>Present in Alpha 2 / unique to Safe</p>
<h2 id="how-it-works">How it works</h2>
<p>Before we get into Sections, we’ll just briefly touch upon bootstrapping
- When a node first joins, it contacts a proxy
- That proxy sends the node to a Section which asks the newcomer to generate a new public/private keypair within a specified range that is covered by that Section.
    - This is different to Bitcoin for SAFE, the ID generation is random, but still defined to a given range. BTC generated at random not within range.<br />
- The new node now has a Public Signing Key which doubles as its XOR address on the Network.</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="question" src="../images/question.png" /></td>
<td align="left"><strong>Nadia Burborough:</strong> 'Public Signing Key'<br>at what point do the encryption key pairs get generated?<br><br><strong>Sarah Pentland:</strong> I don't know the answer to this one, need dev team help here</td>
</tr>
</tbody>
</table>
<h3 id="sections">Sections</h3>
<p>A subset of all the addresses on the Network. The Network is a 32 byte or 256 bit range of addresses.</p>
<ul>
<li>256 bit = 2 to the power of 256 possible combinations (78 digits)</li>
</ul>
<p><strong>The Network Invariant specified for Disjoint sections:</strong>
- Each prefix is responsible for part of the network, a node cannot be in more than 1 Section (unlike a Group)
- No overlap because the Section is defined by the node’s prefix
- So a node that has a prefix 11001… will be in that Section - it cannot be in e.g. Section 10101</p>
<h3 id="neighbours">Neighbours</h3>
<p>Are Sections that have a prefix which differs from their own prefix by one single bit.  </p>
<p>In the example of:
00, 01, 10, 11 (which covers the whole network space)
00’s neighbours are 01 and 10 only.
11 does not count as a Neighbour (as the prefix differs by 2 bits).</p>
<p>Once you identify a Section as your neighbour, they also identify you as their Neighbour.</p>
<h3 id="siblings">Siblings</h3>
<p>Are a special subset of Neighbours. Siblings have prefixes that differ by only 1 bit at the very last bit. In the example above, 01 would be the sibling to 00. Siblings are crucial for merges. If no Sibling exists when a merge is required, the Sections would have to collapse/merge until a Sibling is created (i.e. the tree collapses upwards until it ends up with a Section whose prefix differs by only the last bit).  </p>
<h3 id="splitting">Splitting</h3>
<p>Splits involve a binary split of one disjoint section into two sibling disjoint sections.<br />
Involves a valid loss of information from a node as it becomes part of a different section which are responsible for a smaller XOR space
Don't require an external source of trust as they got enough information from the section they used to be a member of. (As opposed to merges where you need to gain info from your sibling and establish trust in the process)
Removing a node will never trigger a disjoint section to split</p>
<h3 id="split-mechanism">Split mechanism</h3>
<ul>
<li>A split may occur when a node joins the section. In order for a split to occur there must be a minimum number (8 - current group size) of peers and a buffer for each child.  </li>
<li>The buffer is required to reduce the likelihood of a re-merge as these are expensive/resource intensive network activities. As there is continual node loss and churn.</li>
<li>The buffer is required to minimise merge events being triggered as a result of a node or two disconnecting. We do not want too many merges as they are resource heavy. All prefix changes are Network expensive.</li>
<li>Splits do not need to happen immediately as unlike mergers there is no risk of data loss, so these can be a key area for Network throttle.</li>
<li>An unbalanced section can split into more than one child on one side. This is known as a multi-split. I.e. 01 would split into 010 and 111. This would occur if there was a very large number of nodes with the prefix 11 and as soon as the split into 10 and 11 occurs there is already enough to split into 110 and 111.  </li>
<li>A split represents a valid loss of information. Nodes from a splitting section will be responsible for less information following a split, as they are now responsible for a smaller section of the Network.     <ul>
<li>This will not be not in Fleming but will be included in Maxwell as there is no data in Fleming</li>
<li>This has benefits to scalability and performance, as the Network grows sections are responsible for less rather than other models in which the greater the information the slower</li>
</ul>
</li>
<li>Splits lead to the loss of neighbours
<img alt="split" src="../images/0201_split.png" /></li>
</ul>
<h3 id="merging">Merging</h3>
<p>Are far more complicated than splits as sections gain information. The merging sections must be able to trust the previously responsible section for all the information.  </p>
<ul>
<li>
<p>Two disjoint sections are merged when one of the siblings membership falls below the minimum group size. A Merge will result in a gain of information</p>
</li>
<li>
<p><em>Removing</em> a node <em>may trigger</em> the merge of two disjoint sections</p>
</li>
<li>
<p>Merges are computationally expensive for the Network - as they require nodes to gain new information (which they need to validate in order to trust it) and responsibilities.</p>
</li>
<li>
<p>It also means that the Nodes’ prefix will change when they form a new Section  </p>
</li>
<li>
<p>Note: post-Fleming, when we have data, the load on the Network will increase, which can impact performance</p>
</li>
<li>
<p>A merge must happen immediately to ensure that data is not inaccessible</p>
</li>
</ul>
<p><img alt="merge" src="../images/0202_merge.png" /></p>
<h2 id="features">Features</h2>
<ul>
<li>
<h3 id="bootstrapping">Bootstrapping</h3>
When a new node joins the Network, it will contact a proxy node. That proxy directs the node to a Section. That Section will then require the new node to generate a Public Signing Key(pair) that is within a specified range (i.e. the range that Section covers). Once it has done this, its functionality will then be tested (via Resource Proof - i.e. does it have the necessary bandwidth etc).</li>
<li>
<h3 id="balanced-relocation">Balanced Relocation</h3>
When a new node requests to join a section, the section will look at the identities of the existing members and in order to ensure balance in the event of a split.</li>
<li>
<h3 id="splits_1">Splits</h3>
A split occurs in a section when the section gets too big and unbalanced.  </li>
<li>
<h3 id="merge">Merge</h3>
Merges happen when there are too few nodes (below minimum group size) in a Section so the nodes ‘merge’ with another Section.  You can only merge with a sibling.  </li>
</ul>
<h2 id="benefits">Benefits</h2>
<ul>
<li>Scalability</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../01_glossary/" title="Glossary" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Glossary
              </span>
            </div>
          </a>
        
        
          <a href="../03_authorities/" title="Authorities" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Authorities
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>